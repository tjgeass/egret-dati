var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),PropsPrice=function(){function e(){}return e.prompt=500,e.reset=500,e.pause=500,e}();__reflect(PropsPrice.prototype,"PropsPrice");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,r){function n(n){t.call(r,n,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?n(a):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){GameData.stage=this,SceenControl.loadHome()},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,r=RES.getRes(e);return t.texture=r,t},t.prototype.startAnimation=function(e){var t=this,r=new egret.HtmlTextParser,n=e.map(function(e){return r.parse(e)}),a=this.textfield,i=-1,o=function(){i++,i>=n.length&&(i=0);var e=n[i];a.textFlow=e;var r=egret.Tween.get(a);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(o,t)};o()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,r,n){function a(e){t.call(n,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),r.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LocalStorageControl=function(){function e(){}return e.initData=function(){egret.localStorage.clear(),egret.localStorage.setItem("icon",InitConfigData.icon.toString()),egret.localStorage.setItem("chapter",InitConfigData.chapter.toString()),egret.localStorage.setItem("prompt",InitConfigData.prompt.toString()),egret.localStorage.setItem("pause",InitConfigData.pause.toString()),egret.localStorage.setItem("reset",InitConfigData.reset.toString()),egret.localStorage.setItem("isInited","1")},e.openChapter=function(){var e=Number(egret.localStorage.getItem("chapter"));100>e&&egret.localStorage.setItem("chapter",(e+1).toString())},e.getChapter=function(){return Number(egret.localStorage.getItem("chapter"))},e.addIcon=function(e){var t=Number(egret.localStorage.getItem("icon"));egret.localStorage.setItem("icon",(t+e).toString())},e.useIcon=function(e){var t=Number(egret.localStorage.getItem("icon"));egret.localStorage.setItem("icon",(t-e).toString())},e.getIcon=function(){return Number(egret.localStorage.getItem("icon"))},e.isInited=function(){return!!egret.localStorage.getItem("isInited")},e.getPropsItemNum=function(e){return Number(egret.localStorage.getItem(e))},e.addPropsItemNum=function(e){var t=Number(egret.localStorage.getItem(e))+1;egret.localStorage.setItem(e,t.toString())},e.usePropsItemNum=function(e){var t=Number(egret.localStorage.getItem(e))-1;egret.localStorage.setItem(e,t.toString())},e}();__reflect(LocalStorageControl.prototype,"LocalStorageControl");var SceenControl=function(){function e(){}return e.loadHome=function(){this.load(new StartSceen)},e.loadGame=function(e){this.load(new GameSceen)},e.load=function(e){GameData.stage.removeChildren();var t=e;GameData.sceen=t,GameData.stage.addChild(t)},e}();__reflect(SceenControl.prototype,"SceenControl");var GameData=function(){function e(){}return e.resetData=function(){this.mapData=new Array},e.maxRow=6,e.maxColumn=6,e.cardHorizontalSpacing=52,e.cardVerticalSpacing=52,e.stageW=960,e.stageH=640,e.elementWidth=600/e.maxColumn,e.elementTypes=["e0_png","e1_png","e2_png","e3_png","e4_png","e5_png","e6_png","e7_png"],e.promptNum=0,e.level=1,e.backgroundImage="defaultBg_png",e}();__reflect(GameData.prototype,"GameData");var InitConfigData=function(){function e(){}return e.icon=1e3,e.chapter=0,e.prompt=3,e.pause=3,e.reset=3,e}();__reflect(InitConfigData.prototype,"InitConfigData");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var TimerData=function(){function e(){}return e.time=90,e.pauseTime=5,e.eleDisappearTime=200,e}();__reflect(TimerData.prototype,"TimerData");var GameElement=function(e){function t(t,r){var n=e.call(this)||this;return n.id=t,n.face=r,n.locationX=t%GameData.maxRow,n.locationY=Math.floor(t/GameData.maxRow),n}return __extends(t,e),t.prototype.update=function(e){this.id=e,this.locationX=e%GameData.maxRow,this.locationY=Math.floor(e/GameData.maxRow)},t}(egret.Sprite);__reflect(GameElement.prototype,"GameElement");var GameSceen=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/eui_skins/GameMainSence.exml",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.init()},t.prototype.init=function(){this.chapter=0,GameData.timerManager=this.time_manager,GameData.timerManager.startPlay(),GameData.gameMap=this.gm},t.prototype.showResult=function(e){this.gm.touchChildren=!1},t}(eui.Component);__reflect(GameSceen.prototype,"GameSceen");var StartSceen=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/eui_skins/BeginSence.exml",t.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,t.startGame,t),t}return __extends(t,e),t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.startGame=function(){this.parent.addChild(GameSceen.getInstance()),this.parent.removeChild(this)},t}(eui.Component);__reflect(StartSceen.prototype,"StartSceen");var CardView=function(e){function t(t,r,n){var a=e.call(this)||this;a.isFlipping=!1,a.elePadding=5,a.id=r,a.face=n;var i=RES.getRes("card_json"),o=RES.getRes("card_png"),s=new egret.MovieClipDataFactory(i,o);return a.mc=new egret.MovieClip(s.generateMovieClipData()),a.addChild(a.mc),a}return __extends(t,e),t.prototype.startFlip=function(e){this.isFlipping=!0,this.flipStep=10,this.flipToFrame=e,this.mc.addEventListener(egret.Event.ENTER_FRAME,this.flip,this)},t.prototype.flip=function(e){this.flipStep--,this.flipStep>5?this.mc.scaleX=.2*(this.flipStep-6):this.mc.scaleX=.2*(5-this.flipStep),5==this.flipStep&&this.mc.gotoAndStop(this.flipToFrame),0==this.flipStep&&this.mc.removeEventListener(egret.Event.ENTER_FRAME,this.flip,this)},t.prototype.targetX=function(){var e=GameData.elementWidth,t=20+e*(this.id%GameData.maxRow)+1*e+this.elePadding;return t},t.prototype.targetY=function(){var e=GameData.elementWidth,t=0,r=e*Math.floor(this.id/GameData.maxColumn)+1*e+this.elePadding,n=t+r;return n},t}(eui.Component);__reflect(CardView.prototype,"CardView");var GameMap=function(e){function t(t){var r=e.call(this)||this;return r.isReady=!1,r.thisParent=t,r.init(),r}return __extends(t,e),t.prototype.init=function(){this.createBottomSprite(),this.createAllElement()},t.prototype.createBottomSprite=function(){var e=new egret.Sprite;this.addChild(e),GameData.eleParentSprite=e},t.prototype.createAllElement=function(){this.touchChildren=!1,this.isReady=!1,GameData.eleParentSprite.removeChildren(),GameData.elementViews=new Array,GameData.mapData=new Array,GameData.elements=new Array;for(var e=new Array,t=(GameData.elementTypes,GameData.elementWidth,GameData.maxRow*GameData.maxColumn),r=0;t>r;r++)if(r%2==0){var n=new GameElement(r,r/2+2),a=new GameElement(r+1,r/2+2);e.push(n),e.push(a)}e=e.sort(function(){return.5-Math.random()});for(var r=0;r<GameData.maxRow;r++)for(var i=0;i<GameData.maxColumn;i++){var o=r+GameData.maxRow*i;GameData.elements[o]=e.shift()}for(var s=(GameData.elementWidth,0);s<GameData.maxRow;s++)for(var l=0;l<GameData.maxColumn;l++){var o=s+GameData.maxRow*l,c=GameData.elements[o];c.update(o);var p=new CardView(GameData.eleParentSprite,o,c.face);p.touchEnabled=!0,p.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickCard,this),p.x=p.targetX(),p.y=p.targetY(),GameData.elementViews[o]=p,GameData.eleParentSprite.addChild(p)}this.touchChildren=!0,this.isReady=!0},t.prototype.clickCard=function(e){var t=e.target;if(null==this.tap1){this.tap1=t;var r=t.face;t.startFlip(r)}else if(this.tap1==t)this.tap1.startFlip(1),this.tap1=null;else if(null==this.tap2){this.tap2=t;var r=t.face;t.startFlip(r),this.tap1.face==this.tap2.face?(this.tap2.startFlip(r),GameData.eleParentSprite.removeChild(this.tap1),GameData.eleParentSprite.removeChild(this.tap2),this.tap1=null,this.tap1=null):(this.flipBackTimer=new egret.Timer(1e3,1),this.flipBackTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.returnCards,this),this.flipBackTimer.start())}else{this.returnCards(null),this.tap1=t;var r=t.face;this.tap1.startFlip(r)}},t.prototype.returnCards=function(e){this.tap1.startFlip(1),this.tap2.startFlip(1),this.tap1=null,this.tap2=null,this.flipBackTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.returnCards,this)},t.prototype.timeout=function(){GameData.eleParentSprite.numChildren?this.lose():this.pass()},t.prototype.pass=function(){this.thisParent.showResult(!0)},t.prototype.lose=function(){this.thisParent.showResult(!1)},t}(eui.Component);__reflect(GameMap.prototype,"GameMap");var TimerView=function(e){function t(){var t=e.call(this)||this;return t._timeTxt="00:00:00",t.initView(),t.addEventListener("timeChange",t.onTimeReflash,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"timeTxt",{get:function(){return this._timeTxt},enumerable:!0,configurable:!0}),t.prototype.initView=function(){this.timeLabel=new eui.Label,this.addChild(this.timeLabel),this._timeCount=(new Date).getTime(),this._time=new egret.Timer(1e3)},t.prototype.startPlay=function(){this._time.addEventListener(egret.TimerEvent.TIMER,this.onTimeHandler,this),this._time.start()},t.prototype.stopTime=function(){this._time.stop(),this._time.removeEventListener(egret.TimerEvent.TIMER,this.onTimeHandler,this)},t.prototype.onTimeHandler=function(e){var t=(new Date).getTime()-this._timeCount;this._timeTxt=this.parseTime(t),this.dispatchEvent(new egret.Event("timeChange"))},t.prototype.onTimeReflash=function(e){this.timeLabel.text=this._timeTxt},t.prototype.parseTime=function(e){var t=0,r=0,n=0;return t=Math.floor(e/36e5),r=Math.floor(e%36e5/6e4),n=Math.floor(e%6e4/1e3),this.getTwoLength(t)+":"+this.getTwoLength(r)+":"+this.getTwoLength(n)},t.prototype.getTwoLength=function(e){return 10>e?"0"+e:""+e},t}(eui.Component);__reflect(TimerView.prototype,"TimerView");